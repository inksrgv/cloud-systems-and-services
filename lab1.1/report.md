# Nginx Default

<details>
<summary> Техническое задание </summary>


**Настроить nginx по заданному тз**

Должен работать по https c сертификатом
Настроить принудительное перенаправление HTTP-запросов (порт 80) на HTTPS (порт 443) для обеспечения безопасного соединения.
Использовать alias для создания псевдонимов путей к файлам или каталогам на сервере.
Настроить виртуальные хосты для обслуживания нескольких доменных имен на одном сервере.
Что угодно еще под требования проекта

**Результат**

Предположим, что у вас есть два пет проекта на одном сервере, которые должны быть доступны по https. Настроенный вами веб сервер умеет работать по https, относить нужный запрос к нужному проекту, переопределять пути исходя из требований пет проектов.
В качестве пет проектов можете использовать что-то свое, можете что-то опенсорсное, можете просто код из трех строчек как например здесь
Важно: В этой лабе прошу вас не углубляться в безопасность nginx, тк так будет интереснее делать лабу со звездочкой)
</details>

## Настройка сертификатов 

Нужно сгенерировать самоподписанный сертификат. Для его хранения создается директория:
```bash
sudo mkdir /etc/nginx/ssl
```

Потом генерируем приватный ключ и сам сертификат:
```bash
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
 -keyout /etc/nginx/ssl/nginx-selfsigned.key \
 -out /etc/nginx/ssl/nginx-selfsigned.crt
```

Нужно будет заполнить общую информацию, а в поле `Common Name` ввести localhost.

![Сертификат](https://github.com/user-attachments/assets/cfd43e3f-94f0-4fd5-837b-a5e6ac0ad4b2)

## Проекты

Посмотрим какие проекты у нас есть:
```bash
sgsoul@honor:/var/www$ tree
.
├── html
│   └── index.nginx-debian.html
├── project1
│   └── index.html
└── project2
    └── index.html

3 directories, 3 files
```
## Настройка конфигураций

Конфигурации будут симметричные, поэтому разбирать будем на примере первого проекта.
Нам необходимо настроить принудительное перенаправление HTTP на HTTPS с помощью `return 301 https://$host$request_uri`. Указываются пути к сертификатам, защищенный `443` порт. 
Дополнительно лдя отладки были указаны пути для логов. 


```bash
sgsoul@honor:/etc/nginx/sites-available$ cat project1
server {
    listen 80;
    server_name project1.local;

    # Принудительное перенаправление HTTP на HTTPS
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name project1.local;

    ssl_certificate /etc/nginx/ssl/nginx-selfsigned.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx-selfsigned.key;


    access_log /var/log/nginx/project1_access.log;
    error_log /var/log/nginx/project1_error.log;

    location / {
        alias /var/www/project1/;
        index index.html;
    }
}
```

Теперь, чтобы nginx'у было хорошо нужно создать Создайте символические ссылки в `sites-enabled`:

```bash
sgsoul@honor:/etc/nginx/sites-enabled$ ll
total 8
drwxr-xr-x 2 root root 4096 Oct  5 15:31 ./
drwxr-xr-x 9 root root 4096 Oct  5 15:26 ../
lrwxrwxrwx 1 root root   34 Oct  5 14:50 default -> /etc/nginx/sites-available/default
lrwxrwxrwx 1 root root   35 Oct  5 15:31 project1 -> /etc/nginx/sites-available/project1
lrwxrwxrwx 1 root root   35 Oct  5 15:31 project2 -> /etc/nginx/sites-available/project2
```

Проверяем, что ничего не поломали случаем: 

```bash
sgsoul@honor:~$ sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

Последним штрихом добавляем нужные хосты:
> Этот шаг необходимо повторять при каждом рестарте WSL (!) 

```bash
sgsoul@honor:/etc$ cat hosts
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateHosts = false
127.0.0.1       localhost
127.0.1.1       irina-honor.localdomain irina-honor

127.0.0.1 project1.local
127.0.0.1 project2.local

<...>
```

Продолжаем радоваться тому, что у нас WSL без systemctl =) Запускаем через `service`

```bash
sgsoul@honor:/etc$ sudo service nginx start
 * Starting nginx nginx                                                                                          [ OK ]
sgsoul@honor:/etc$
```

Проверяем, что и все работает: 

```bash
sgsoul@honor:~$ curl -k https://project1.local/
hello pr1
sgsoul@honor:~$ curl -k https://project2.local/
hello pr2
```

Добавим немножко стиля и красота!
![Снимок экрана 2024-10-11 202743](https://github.com/user-attachments/assets/3d7475c1-335b-4025-97fe-bc9b78a6aa5b)


